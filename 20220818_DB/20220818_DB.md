### ğŸ§ ì‹¤ìŠµ í•´ì„¤ 

```sql
-- 5ë²ˆ ë¬¸ì œ 
SELECT id, waist FROM healthcare    -- id, waist ë‚´ê°€ ë³´ê³  ì‹¶ì€ ì»¬ëŸ¼ ì§€ì • 
WHERE is_drinking = 1 AND waist != ''      -- ìŒì£¼ë¥¼ í•˜ëŠ” ì‚¬ëŒ(1)
ORDER BY waist DESC   -- í—ˆë¦¬ë‘˜ë ˆë¥¼ ë†’ì€ ìˆœìœ¼ë¡œ 
LIMIT 5;   -- 5ëª… ì¶œë ¥ 

-- ê°™ì€ í‘œí˜„ 
waist != ''
NOT waist = ''
wais <> ''

```



```sql
-- 11ë²ˆ ë¬¸ì œ 	
SELECT COUNT(*) FROM healthcare 
WHERE weight/((height*0.01)*(height*0.01)) >= 30;

SELECT id, height, weight, weight/((height*0.01)*(height*0.01))
FROM healthcare 
WHERE weight/((height*0.01)*(height*0.01)) >= 30;
LIMIT 3;

-- BIM ë³„ì¹­ì„ ì‚¬ìš©í•˜ì—¬ í™œìš©í•˜ê¸°
SELECT
	id, 
	height AS í‚¤,
	weight AS ëª¸ë¬´ê²Œ, 
	weight/((height*0.01)*(height*0.01)) AS BMI
FROM healthcare
WHERE BMI >= 30
LIMIT 3;


```



```sql
-- 12ë²ˆë¬¸ì œ 

SELECT
	id, 
	weight ëª¸ë¬´ê²Œ,
	height í‚¤,
	weight/((height*0.01)*(height*0.01)) AS BMI
FROM healthcare
WHERE smoking = 3
ORDER BY BMI DESC
LIMIT 5;

```



---



### ğŸ“‘ ê¸°ë³¸ í•¨ìˆ˜ì™€ ì—°ì‚° 



#### ğŸ’¡ ë¬¸ìì—´ í•¨ìˆ˜ 

* **SUBSTR(ë¬¸ìì—´, start, lenght)** : ë¬¸ìì—´ ìë¥´ê¸° 
  * ì‹œì‘ ì¸ë±ìŠ¤ 1, ë§ˆì§€ë§‰ ì¸ë±ìŠ¤ëŠ” -1
* **TRIM(ë¬¸ìì—´), LTRIM(ë¬¸ìì—´), RTRIM(ë¬¸ìì—´)** : ë¬¸ìì—´ ê³µë°± ì œê±° 
* **LENGTH(ë¬¸ìì—´)** : ë¬¸ìì—´ ê¸¸ì´ 
* **REPLACE (ë¬¸ìì—´, íŒ¨í„´, ë³€ê²½ê°’)** : íŒ¨í„´ì— ì¼ì¹˜í•˜ëŠ” ë¶€ë¶„ì„ ë³€ê²½
* **UPPER, LOWER** : ëŒ€ì†Œë¬¸ì ë³€ê²½
* **||** : ë¬¸ìì—´ í•©ì¹˜ê¸° (concatenation)



```sql
SELECT * FROM users LIMIT 1;
-- bash
-- sqlite> .mode column
-- sqlite> SELECT * FROM users LIMIT 1;

-- (1)
-- ë¬¸ìì—´ í•©ì¹˜ê¸° ||
-- (ì„±+ì´ë¦„), 5ëª… 

-- ì–´ë– í•œ ëª¨ìŠµìœ¼ë¡œ ì¶œë ¥ì´ ë ì§€ ìƒê°í•´ ë³´ë©´ì„œ ì‘ì„±í•´ë³´ê¸° 

SELECT 
	last_name \\ first_name ì´ë¦„,
	age,
	country,
	phone,
	balance
FROM users
LIMIT 5;

```



```sql
-- (2)
-- ë¬¸ìì—´ ê¸¸ì´ LENGTH

SELECT
	LENGTH(first_name),
	first_name
FROM users
LIMIT 5;


-- (3)
-- ë¬¸ìì—´ ë³€ê²½ REPLACE
-- 016-7280-2855 => 01672802855
-- ì‹¤ì œ DB ê°’ì„ ìˆ˜ì •í•  ìˆ˜ ëŠ” ì—†ìŒ 

SELECT
	first_name,
	phone,s
	REPLACE(phone, '-', ' ')
FROM users
LIMIT 5;
```



#### ğŸ’¡ ìˆ«ì í•¨ìˆ˜ 

* **ABS(ìˆ«ì) : ì ˆëŒ€ê°’**
* **SIGN(ìˆ«ì) : ë¶€í˜¸ (ì–‘ìˆ˜ 1, ìŒìˆ˜ -1, 0 0)**
* **MOD(ìˆ«ì1, ìˆ«ì2) : ìˆ«ì 1ì„ ìˆ«ì 2ë¡œ ë‚˜ëˆˆ ë‚˜ë¨¸ì§€** 
* **CEIL(ìˆ«ì), FLOOR(ìˆ«ì), ROUND(ìˆ«ì, ìë¦¬) : ì˜¬ë¦¼, ë‚´ë¦¼, ë°˜ì˜¬ë¦¼**
* **POWER(ìˆ«ì) : ì œê³±ê·¼** 



```sql
-- ìˆ«ì í™œìš© 

SELECT MOD(5, 2)
FROM users
LIMIT 1;

-- ì˜¬ë¦¼, ë‚´ë¦¼, ë°˜ì˜¬ë¦¼

SELECT CEIL(3.14), FLOOR(3.14), ROUND(3.14)
FROM users
LIMIT 1;

-- 9ì˜ ì œê³±ê·¼

SELECT SQRT(9)
FROM users
LIMIT 1;

-- 9^2

SELECT POWER(9, 2)
FROM users
LIMIT 1;

```





* **ì‚°ìˆ  ì—°ì‚°ì** 

> +, -, *, / ì™€ ê°™ì€ ì‚°ìˆ  ì—°ì‚°ìì™€ ìš°ì„  ìˆœìœ„ë¥¼ ì§€ì •í•˜ëŠ” () ê¸°í˜¸ë¥¼ ì—°ì‚°ì— í™œìš©í•  ìˆ˜ ìˆìŒ 

```sql
SELECT age+1 FROM users;
```



---



### ğŸ“‘ GROUP BY

**_ Agrregate function (ì§‘ê³„í•¨ìˆ˜) ë‹¤ì‹œë³´ê¸°** 

* ê°’ ì§‘í•©ì— ëŒ€í•œ ê³„ì‚°ì„ ìˆ˜í–‰í•˜ê³  **ë‹¨ì¼ ê°’ì„ ë°˜í™˜**
  * ì—¬ëŸ¬ í–‰ìœ¼ë¡œë¶€í„° í•˜ë‚˜ì˜ ê²°ê´ê°’ì„ ë°˜í™˜í•˜ëŠ” í•¨ìˆ˜ 
* SELECT êµ¬ë¬¸ì—ì„œë§Œ ì‚¬ìš©ë¨ 

> í…Œì´ë¸” ì „ì²´ í–‰ ìˆ˜ë¥¼ êµ¬í•˜ëŠ” **COUNT(*)**
>
> age ì»¬ëŸ¼ ì „ì²´ í‰ê·  ê°’ì„ êµ¬í•˜ëŠ” **AVG(age)**



![image-20220818140337776](20220818_DB.assets/image-20220818140337776.png)





* **ALIAS** 

  * ì¹¼ëŸ¼ëª…ì´ë‚˜ í…Œì´ë¸”ëª…ì´ ë„ˆë¬´ ê¸¸ê±°ë‚˜ ë‹¤ë¥¸ ëª…ì¹­ìœ¼ë¡œ í™•ì¸í•˜ê³  ì‹¶ì„ ë–„ëŠ” ALIASë¥¼ í™œìš©
  * **ASë¥¼ ìƒëµí•˜ì—¬ ê³µë°±ìœ¼ë¡œ í‘œí˜„í•  ìˆ˜ ìˆìŒ**
  * ë³„ì¹­ì— ê³µë°±, íŠ¹ìˆ˜ë¬¸ì ë“±ì´ ìˆëŠ” ê²½ìš° ë”°ì˜´í‘œë¡œ ë¬¶ì–´ì„œ í‘œê¸° 

  ```sql
  SELECT last_name ì„± FROM users;
  SELECT last_name AS ì„± FROM users;
  SELECT last_name AS ì„± FROM users WHERE ì„±='ê¹€'
  ```

  



#### ğŸ’¡ GROUP BY 

#### (í–‰ì„ ê·¸ë£¹í•´ì£¼ëŠ” ê²ƒì´ê³  ê°ê° ì§‘ê³„í•¨ìˆ˜ë¡œ ë„˜ê²¨ì£¼ëŠ” ê²ƒ)

* ì§€ì •ëœ ì»¬ëŸ¼ì˜ ê°’ì´ ê°™ì€ í–‰ë“¤ë¡œ ë¬¶ìŒ
* **â­ ì§‘ê³„í•¨ìˆ˜ì™€ í™œìš©í•˜ì˜€ì„ ë•Œ ì˜ë¯¸ê°€ ìˆìŒ**(ê°™ì´ ë¬¶ì–´ì„œ ì¡°íšŒí•´ì£¼ê¸° ë•Œë¬¸)
* ê·¸ë£¹í™”ëœ ê°ê°ì˜ ê·¸ë£¹ì´ í•˜ë‚˜ì˜ ì§‘í•©ìœ¼ë¡œ ì§‘ê³„í•¨ìˆ˜ì˜ ì¸ìˆ˜ë¡œ ë„˜ê²¨ì§

![image-20220818140848663](20220818_DB.assets/image-20220818140848663.png)



**ğŸ“Œ usersì—ì„œ ê° ì„±(last_name) ì”¨ê°€ ëª‡ëª…ì´ ìˆëŠ”ì§€ í™•ì¸í•˜ì‹œì˜¤.** 

```sql
-- group by

-- ì„±_ë³„ ê°¯ìˆ˜ 
SELECT last_name, COUNT(*)
FROM users
GROUP BY last_name;

-- â­ group by ì—ì„œ í™œìš©í•˜ëŠ” ì»¬ëŸ¼ì„ ì œì™¸í•˜ê³ ëŠ” ë°˜ë“œì‹œ ì§‘ê³„í•¨ìˆ˜ë¥¼ ì‚¬ìš©í•˜ì„¸ìš”. 
SELECT last_name, age, COUNT(*)
FROM users
GROUP BY last_name;

SELECT last_name, AVG(age), COUNT(*)
FROM users
GROUP BY last_name;

SELECT last_name, age, COUNT(*)
FROM users
GROUP BY last_name = 'ê³½';


-- GROUP BYëŠ” ê²°ê³¼ê°€ ì •ë ¬ë˜ì§€ ì•Šì•„ìš”. ê¸°ì¡´ ìˆœì„œì™€ ë°”ë€œ
-- ì›ì¹™ì ìœ¼ë¡œ ë‚´ê°€ ì •ë ¬í•´ì„œ ë³´ê³  ì‹¶ë‹¤ë©´, ORDER BYë¥¼ ì •í™•í•˜ê²Œ ì‚¬ìš©í•˜ëŠ” ê²ƒì´ ë§ë‹¤. 

SELECT *
FROM users
LIMIT 5;

SELECT last_name, COUNT(*)
FROM users
GROUP BY last_name
LIMIT 5;
```



#### ğŸ’¡ SELECT ë¬¸ì¥ ì‹¤í–‰ ìˆœì„œ 

* **FROM => WHERE => GROUP BY => HAVING => SELECT => ORDER BY**

  * FROM  í…Œì´ë¸”ì„ ëŒ€ìƒìœ¼ë¡œ 

  * WHERE ì œì•½ì¡°ê±´ì— ë§ì¶°ì„œ ë½‘ì•„ì„œ 

  * GROUP BY ê·¸ë£¹í™” í•œë‹¤. 

  * HAVING ê·¸ë£¹ ì¤‘ì— ì¡°ê±´ê³¼ ë§ëŠ” ê²ƒ ë§Œì„ 

  * SELECT ì¡°íšŒí•˜ì—¬ 

  * ORDER BY ì •ë ¬í•˜ê³  

  * LIMIT/OFFSET íŠ¹ì • ìœ„ì¹˜ì˜ ê°’ì„ ê°€ì ¸ì˜¨ë‹¤. 

    

```sql
SELECT ì¹¼ëŸ¼ëª…
FROM í…Œì´ë¸”ëª… 
WHERE ì¡°ê±´ì‹
GROUP BY ì¹¼ëŸ¼ í˜¹ì€ í‘œí˜„ì‹
HAVING ê·¸ë£¹ì¡°ê±´ì‹
ORDER BY ì¹¼ëŸ¼ í˜¹ì€ í‘œí˜„ì‹
LIMIT ìˆ«ì OFFSET ìˆ«ì;
```



![image-20220818141209153](20220818_DB.assets/image-20220818141209153.png)



![image-20220818141349930](20220818_DB.assets/image-20220818141349930.png)



![image-20220818141649960](20220818_DB.assets/image-20220818141649960.png)



---



```sql
-- GROUP BY ì—ì„œ WHEREì„ ì‚¬ìš©í•˜ê³  ì‹¶ë‹¤ë©´? 

-- ğŸ”´ ì£¼ì˜í• ì 
-- 100 ì´ìƒ ë“±ì¥í•œ ì„±ë§Œ ì¶œë ¥í•˜ê³  ì‹¶ë‹¤.  _ ì˜¤ë¥˜ë°œìƒ 
-- ì§‘ê³„í•¨ìˆ˜ ìì²´ì˜ ì‹¤í–‰ìˆœì„œë¡œ ì¸í•´ ì•ˆë¨ _ê·¸ë£¹í™”ê°€ ì•ˆë˜ì–´ ìˆê¸°ë•Œë¬¸ì— ì˜¤ë¥˜ ë°œìƒ
SELECT last_name, COUNT(last_name)
FROM users
WHERE COUTN(last_name) > 100
GROUP BY last_name


-- ì¡°ê±´ì— ë”°ë¥¸ group ì„ í•˜ë ¤ë©´ 
-- HAVING ì„ ì‚¬ìš©í•œë‹¤. 
SELECT last_name, COUNT(last_name)
FROM users
GROUP BY last_name
HAVING COUNT(last_name) > 100;
```



#### ğŸ’¡ HAVING

* ì§‘ê³„í•¨ìˆ˜ëŠ” WHERE ì ˆì˜ ì¡°ê±´ì‹ì—ì„œëŠ” ì‚¬ìš©í•  ìˆ˜ ì—†ìŒ_ì‹¤í–‰ ìˆœì„œì— ì˜í•´ 
  * **WHERE ë¡œ ì²˜ë¦¬í•˜ëŠ” ê²ƒì´ GROUP BY ê·¸ë£¹í™”ë³´ë‹¤ ìˆœì„œìƒ ì•ì„œ ìˆê¸° ë•Œë¬¸**
* ì§‘ê³„ ê²°ê³¼ì—ì„œ ì¡°ê±´ì— ë§ëŠ” ê°’ì„ ë”°ë¡œ í™œìš©í•˜ê¸° ìœ„í•´ì„œ HAVING ì„ í™œìš© 

```sql
SELECT * FROM í…Œì´ë¸” ì´ë¦„ GROUP BY ì»¬ëŸ¼1, ì»¬ëŸ¼2
HAVING ê·¸ë£¹ ì¡°ê±´;
```



---



### ALTER TABLE

* ALTER TABLE _ ì–¸ì–´ë³„ë¡œ ì°¨ì´ì ì´ ìˆë‹¤. 

> (1) í…Œì´ë¸” ì´ë¦„ë³€ê²½
>
> (2) ìƒˆë¡œìš´ column ì¶”ê°€ 
>
> (3) column ì´ë¦„ìˆ˜ì • (new in sqlite 3.25.0)
>
> (4) column ì‚­ì œ (new in sqlite 3.35.0)



```sql
-- 1. í…Œì´ë¸” ì´ë¦„ ë³€ê²½

ALTER TABLE table_name
RENAME TO new_name;

-- 2. ìƒˆë¡œìš´ ì»¬ëŸ¼ ì¶”ê°€ 
ALTER TABLE table_name
ADD COLUMN column_definition;

-- 3. ì»¬ëŸ¼ ì´ë¦„ ìˆ˜ì •
ALTER TABLE table_name
RENAME COLUMN current_name TO new_name;

-- 4. ì»¬ëŸ¼ ì‚­ì œ 
ALTER TABLE table_name
DROP COLUMN column_name;
```





**ğŸ“Œ tile ê³¼ content ë¼ëŠ” ì»¬ëŸ¼ì„ ê°€ì§„ articles ë¼ëŠ” ì´ë¦„ì˜ tableì„ ìƒˆë¡­ê²Œ ë§Œë“¤ì–´ ë³´ì„¸ìš”.**

**(ë‘ ì»¬ëŸ¼ ëª¨ë‘ ë¹„ì–´ ìˆìœ¼ë©´ ì•ˆë˜ë©° rowidë¥¼ ì‚¬ìš©)**

```sql
CREATE TABLE articles (
title TEXT NOT NULL,
content TEXT NOT NULL
)
```



**ğŸ“Œ articles í…Œì´ë¸”ì— ê°’ ì¶”ê°€í•˜ê¸° (titleì€ '1ë²ˆ ì œëª©', contentëŠ” '1ë²ˆ ë‚´ìš©')**

```sql
INSERT INTO articles VALUES ('1ë²ˆì œëª©', '1ë²ˆ ë‚´ìš©');
```



---



**â—¼ ë°©ê¸ˆ ë§Œë“  í…Œì´ë¸”ì˜ ì´ë¦„ì„ ë³€ê²½ í•´ë³´ì** 

```sql
ALTER TABLE ê¸°ì¡´ í…Œì´ë¸” ì´ë¦„ RENAME TO ìƒˆë¡œìš´ í…Œì´ë¸” ì´ë¦„;
```

```bash
sqlite> ALTER TABLE âœ”articles RENAME TO âœ”news;
sqlite> .tables
classmates   examples    âœ”news      users
```



**â—¼ ë°©ê¸ˆ ë§Œë“  í…Œì´ë¸”ì˜ ìƒˆë¡œìš´ ì»¬ëŸ¼ì„ ì¶”ê°€í•´ë³´ì**

```sql
ALTER TABLE í…Œì´ë¸” ì´ë¦„ ADD COLUMN ì»¬ëŸ¼ì´ë¦„ ë°ì´í„°íƒ€ì… ì„¤ì •;
```



**â—¼ ìƒˆë¡œìš´ ì»¤ëŸ¼ ì´ë¦„ì€ created_at, TEXT íƒ€ì…ì— NULL ì„¤ì •** 

```sql
ALTER TABLE news ADD COLUMN created_at TEXT NOT NULL;
```

**â‰ ì˜¤ë¥˜ ë°œìƒ â‰**

```bash
sqlite> ALTER TABLE news ADD COLUMN created_at TEXT NOT NULL;
Error: Cannot add a NOT NULL column with default value NULL
```



**1ï¸âƒ£ NOT NULL ì„¤ì • ì—†ì´ ì¶”ê°€í•˜ê¸°** 

```bash
sqlite> ALTER TABLE news ADD COLUMN created_at TEXT NOT NULL;
sqlite> INSERT INTO news VALUES('ì œëª©', 'ë‚´ìš©', datetime('now'));
sqlite> SELECT * FROM news;

title       content       created_at
--------    ----------    ------------
1ë²ˆì œëª© 		1ë²ˆ ë‚´ìš©		_______
ì œëª©			ë‚´ìš©			2021-06-03
```



**2ï¸âƒ£ ê¸°ë³¸ ê°’ (DEFAULT) ì„¤ì •í•˜ê¸°** 

```bash
sqlite> ALTER TABLE news ADD COLUMN  subtitle TEXT NOT NULL DEFAULT 'ì†Œì œëª©'
sqlite> SELECT * FROM news;

title       content       created_at     subtitle
--------    ----------    ------------   -----------
1ë²ˆì œëª© 		1ë²ˆ ë‚´ìš©						ì†Œì œëª© (ğŸ”» ê¸°ë³¸ê°’ìœ¼ë¡œ ì„¤ì •ë¨)
ì œëª©			ë‚´ìš©			2021-06-03 		 ì†Œì œëª©
```

